{{ define "breadcrumb" }}
  {{ partial "breadcrumb.html" . }}
{{ end }}
{{ define "main" }}
  <article id="skip-to-content" role="article" aria-labelledby="{{ anchorize .Title }}">
    <header aria-labelledby="{{ anchorize .Title }}" role="heading">
      <hgroup>
        <h1 id="{{ anchorize .Title }}">{{ .Title }}</h1>
        {{- with .Params.subtitle }}
        <h2 class="subtitle">{{ . }}</h2>
        {{- end }}
      </hgroup>
    </header>
    <section class="content" role="region" aria-label="Content">
      {{ .Content }}
    </section>
    <footer role="complementary" aria-label="Metadata and Related Posts">
      <nav aria-labelledby="skip-to-posts-metadata">
        <h2 id="skip-to-posts-metadata">Metadata</h2>
        <dl>
          {{- with .Date }}<dt>Published:</dt><dd><time datetime="{{ dateFormat $.Site.Params.iso8601_format . }}">{{ dateFormat "2006-01-02" . }}</time></dd>{{- end }}
          {{ if ne .Lastmod .Date }}
            <dt>Last Modified:</dt>
            <dd><time datetime="{{ .Lastmod.Format $.Site.Params.iso8601_format }}">{{ .Lastmod.Format "2006-01-02" }}</time></dd>
          {{ end }}
          {{- with .Params.tags }}
            <dt id="skip-to-tags">Tags:</dt>
            <dd>
              {{ partial "tags.html" . }}
            </dd>
          {{- end }}
          {{- with .PrevInSection }}
            <dt>Previous post:</dt>
            <dd>
              <a href="{{ .Permalink }}" rel="prev"><cite>{{ .Title }}</cite></a>
            </dd>
          {{- end }}
          {{- with .NextInSection }}
            <dt>Next post:</dt>
            <dd>
              <a href="{{ .Permalink }}" rel="next"><cite>{{ .Title }}</cite></a>
            </dd>
          {{- end }}
          {{- with .Params.series }}
            {{- range (where $.Site.Data.series "key" "eq" .) }}
              {{- $title := .title }}
              <dt>Series:</dt>
              <dd><a name='skip-to-series-navigation' href="{{ "series" | absURL }}/{{ .key | urlize }}" rel="bookmark">{{ $title }}</a></dd>
              {{- $series := where $.Site.Pages "Params.series" .key }}
              {{- $prev := where $series ".PublishDate" "lt" $.Page.PublishDate }}
              {{- range first 1 $prev }}
                <dt>Previous in series:</dt>
                <dd><a rel="prev" aria-label="Previous {{ $title }} post" href="{{ .Permalink }}">{{ .Title }}</a></dd>
              {{- end}}
              {{- $next := where $series ".PublishDate" "gt" $.Page.PublishDate }}
              {{- range last 1 $next }}
                <dt>Next in series:</dt>
                <dd><a rel="next" aria-label="Next {{ $title }} post" href="{{ .Permalink }}">{{ .Title }}</a></dd>
              {{- end}}
            {{- end}}
          {{- end }}
        </dl>
      </nav>
      <nav aria-labelledby="skip-to-related-posts">
        <h2 id="skip-to-related-posts">Related Posts</h2>
        <ul>
          {{ range first 5 (.Site.RegularPages.Related .) }}
            <li>
              <a aria-label="Related post: {{ .Title }}" href="{{ .RelPermalink }}"><cite>{{ .Title | markdownify }}</cite></a>
            </li>
          {{ end }}
        </ul>
      </nav>
    </footer>
  </article>
{{ end }}
